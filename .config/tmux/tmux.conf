# dwm-tmux

set -g display-time 1080
set -g history-limit 30000
set -sg default-terminal "tmux-256color" # "xterm-256color"
#set -sg terminal-overrides "xterm*:smcup@:rmcup@"
#setw -g xterm-keys on

# Appearence

set -g status 2 # on
set -g status-position top
set -g status-interval 60
setw -g aggressive-resize on
setw -g window-active-style default

set -g @gaps single

setw -Fg pane-border-lines '#{@gaps}'
setw -Fg popup-border-lines '#{@gaps}'
setw -Fg menu-border-lines '#{@gaps}'

set -g @normbgcolor "#222222"
set -g @normbordercolor "#444444"
set -g @normfgcolor "#bbbbbb"
set -g @selfgcolor "#eeeeee"
set -g @selbordercolor "#770000"
set -g @selbgcolor "#005577"

set -Fg @norm 'bg=#{@normbgcolor} fg=#{@normfgcolor}'
set -Fg @normborder 'fg=#{@normbordercolor}'
set -Fg @sel 'bg=#{@selbgcolor} fg=#{@selfgcolor}'
set -Fg @selborder 'fg=#{@selbordercolor}'

set -Fg display-panes-color '#{@normbordercolor}'
set -Fg display-panes-active-color '#{@selbordercolor}'
set -Fg status-style '#{fg=@normfgcolor}'
set -Fg status-left-style '#{@norm}'
set -Fg status-right-style '#{@norm}'
set -Fg message-style '#{@sel}'
set -Fg message-command-style '#{@sel}'
setw -Fg pane-border-style '#{@normborder}'
setw -Fg pane-active-border-style '#{@selborder}'
setw -Fg popup-border-style '#{@selborder}'
setw -Fg menu-border-style '#{@selborder}'
setw -Fg menu-style '#{@norm}'
setw -Fg menu-selected-style '#{@sel}'
setw -Fg window-status-style '#{@norm}'
setw -Fg window-status-activity-style '#{@norm}'
setw -Fg window-status-bell-style '#{@norm}'
setw -Fg window-status-current-style '#{@sel}'
setw -Fg mode-style 'hidden' # '#{@sel}'
setw -Fg copy-mode-current-match-style '#{@sel}'
setw -Fg copy-mode-match-style '#{@norm}'
setw -Fg copy-mode-mark-style '#{@norm}'

set -g status-format[0] '#{W:#[range=window|#{window_index} #{E:window-status-style}] #{E:window-status-format} ,#[range=window|#{E:window_index} #{E:window-status-current-style}] #{E:window-status-current-format} }'
set -ag status-format[0] '#[default align=left range=left fill=#{@normbgcolor} #{E:status-left-style}] #{E:status-left}'
set -ag status-format[0] '#[default align=right range=right #{E:status-right-style}]#{E:status-right}'
set -g status-format[1] '#[hidden]'
set -g status-left '#{@layout-symbol} #{?#{pane_title},#[fill=#{@selbgcolor} #{window-status-current-style}] #T ,}'
set -g status-right 'tmux-#{version}'
setw -g window-status-format '#{window_index}'
setw -g window-status-current-format '#{window_index}'

set -g set-titles on
set -g set-titles-string '#T'
setw -g pane-border-format ''

set-hook -g after-new-session  {
	selectp -T ''
	send ^l
}

set-hook -g after-new-window {
	selectp -T ''
	send ^l
}

set-hook -g after-split-window {
	selectp -T ''
	send ^l
}

# wal

set -g @waldwm '~/.cache/wal/colors-wal-dwm.h'

if 'command -v wal >/dev/null 2>&1 && [ -f #{@waldwm} ]' {
	run 'tmux \
	set -Fg @normfgcolor $(grep -m1 norm_fg #{@waldwm} | cut -d"\"" -f2) \; \
	set -Fg @normbgcolor $(grep -m1 norm_bg #{@waldwm} | cut -d"\"" -f2) \; \
	set -Fg @normbordercolor $(grep -m1 norm_border #{@waldwm} | cut -d"\"" -f2) \; \
	set -Fg @selfgcolor $(grep -m1 sel_fg #{@waldwm} | cut -d"\"" -f2) \; \
	set -Fg @selbgcolor $(grep -m1 sel_bg #{@waldwm} | cut -d"\"" -f2) \; \
	set -Fg @selbordercolor $(grep -m1 sel_border #{@waldwm} | cut -d"\"" -f2)'
}

# Layouts

set -g base-index 1
set -g renumber-windows on

if -F '#{?@mfact,0,1}' {
	set -g @mfact 50
}

if -F '#{?@layout,0,1}' {
	set -g @layout main-vertical
}

if -F '#{?@layout-symbol,0,1}' {
	set -g @layout-symbol "[]="
}

set -sg command-alias[1] setmfact='
	if -F "{e|#{?#{==:#{@op},+},>,<}|:#{@mfact},#{?#{==:#{@op},+},5,95}}" {
		set -F @mfact "#{e|#{@op}|:#{@mfact},5}"
	}
	run -C "resizep -t:.0 -x #{@mfact}% -y #{@mfact}%"'

set -sg command-alias[2] setlayout-tile='
	set @layout-symbol "[]="
	set @layout main-vertical
	selectl main-vertical'

set -sg command-alias[3] setlayout-bstack='
	set @layout-symbol "TTT"
	set @layout main-horizontal
	selectl main-horizontal'

#set -sg command-alias[4] setlayout-spiral='
#	set @layout-symbol "%"
#	set @layout
#	selectl'

#set -sg command-alias[5] setlayout-dwindle='
#	set @layout-symbol "[\\]"
#	set @layout
#	selectl'

set -sg command-alias[6] setlayout-deck='
	set @layout-symbol "[D]"
	set @layout even-vertical
	selectl even-vertical'

set -sg command-alias[7] setlayout-monocle='
	set @layout-symbol "[M]"
	set @layout even-horizontal
	selectl even-horizontal'

set -sg command-alias[8] setlayout-centeredmaster='
	set @layout-symbol "|M|"
	set @layout tiled
	selectl tiled'

#set -sg command-alias[9] setlayout-centeredfloatingmaster='
#	set @layout-symbol ">M>"
#	set @layout
#	selectl'

set-hook -g after-select-layout {
	run -C \
		"resizep -t:.0 -x #{@mfact}% -y #{@mfact}%"
}

set-hook -g after-select-window {
	run -C \
		"selectl #{@layout} \; \
		resizep -t:.0 -x #{@mfact}% -y #{@mfact}%"
}

set-hook -g pane-exited {
	run -C \
		"selectl #{@layout} \; \
		resizep -t:.0 -x #{@mfact}% -y #{@mfact}%"
}

set-hook -g after-kill-pane {
	run -C \
		"selectl #{@layout} \; \
		resizep -t:.0 -x #{@mfact}% -y #{@mfact}%"
}

set-hook -ag after-split-window {
	run -C \
		"selectl #{@layout} \; \
		resizep -t:.0 -x #{@mfact}% -y #{@mfact}%"
}

# Commands

## Tag Aliases

set -sg command-alias[10] view='
	if "tmux has -t:#{@tag}" {
		run -C "selectw -t:#{@tag}"
		} {
		run -C "neww -t:#{@tag}"
	}'

set -sg command-alias[11] tag='
	if "tmux has -t:#{@tag}" {
		run -C "joinp -t:#{@tag}"
		} {
		run -C "breakp -t:#{@tag}"
	}'

set -sg command-alias[12] shiftview='
	set -F @tag "#{e|#{@op}|:#{window_index},1}"
	if -F "#{&&:#{e|>|:#{@tag},0},#{e|<|:#{@tag},10}}" {
		if "tmux has -t:#{@tag}" {
			run -C "selectw -t:#{@tag}"
			} {
			run -C "neww -t:#{@tag}"
		}
	}'

set -sg command-alias[13] shifttag='
	set -F @tag "#{e|#{@op}|:#{window_index},1}"
	if -F "#{&&:#{e|>|:#{@tag},0},#{e|<|:#{@tag},10}}" {
		if "tmux has -t:#{@tag}" {
			run -C "joinp -t:#{@tag}"
			} {
			run -C "breakp -t:#{@tag}"
		}
	}'

set -sg command-alias[14] togglebar='
	set -F status "#{?#{==:#{status},off},2,off}"'

## Stack Aliases

set -sg command-alias[15] focusmon='
	run -C "selectp -t:.#{@op}"'

set -sg command-alias[16] stacker='
	run -C "rotatew -#{?#{==:#{@op},+},D,U}"'

set -sg command-alias[17] zoom='
	swapp -s :. -t:.0
	selectp -t:.0'

set -sg command-alias[18] togglefullscr='
	resizep -Z'

set -sg command-alias[19] togglefloating='
	resizep -Z'

set -sg command-alias[20] spawn='
	run "#{@shcmd} >/dev/null 2>&1 || true"'

set -sg command-alias[21] command='
	if -F "#{==:#{pane_current_command},zsh}" {
		run -C "send ^u \"#{@shcmd}\" Enter"
	}'

set -sg command-alias[22] terminal='
	run -C "splitw -t:.0 #{?@shcmd,\"#{@shcmd}\",}"
	swapp -s:.0 -t:.1'

set -sg command-alias[23] killclient='
	killp'

set -sg command-alias[24] togglescratch='
	run -C "popup -E #{?@shcmd,\"#{@shcmd}\",}"'

set -sg command-alias[25] togglegaps='
	if -F "#{==:#{pane-border-style},hidden}" {
		set -u pane-active-border-style
		set -u pane-border-style
		} {
		set pane-active-border-style hidden
		set pane-border-style hidden
	}'

set -sg command-alias[26] defaultgaps='
	set -u pane-active-border-style
	set -u pane-border-style'

set -sg command-alias[27] incrgaps='
	set -F pane-border-lines "#{?#{==:#{@op},+},double,single}"'

## urlhandler
set -g command-alias[0] copyurlcmd='
	capturep
	saveb "$PREFIX/tmp/tmux-buffer"
	neww -t:0 "urlview < $PREFIX/tmp/tmux-buffer"
	resizep -Z'

# Keys

#set -g default-command "$SHELL"

set -sg escape-time 20

set -g prefix M-# # Pseudo Super key

unbind -aT prefix
unbind -aT copy-mode
#unbind -aT copy-mode-vi
#unbind -aT root

bind C-r source-file ~/.config/tmux/tmux.conf
bind C-v command-prompt

bind -n M-y copyurlcmd

bind ` set @shcmd 'dmenuunicode' \; spawn
bind 1 set @tag '1' \; view
bind 2 set @tag '2' \; view
bind 3 set @tag '3' \; view
bind 4 set @tag '4' \; view
bind 5 set @tag '5' \; view
bind 6 set @tag '6' \; view
bind 7 set @tag '7' \; view
bind 8 set @tag '8' \; view
bind 9 set @tag '9' \; view
bind 0 set @tag '0' \; view
bind ! set @tag '1' \; tag
bind @ set @tag '2' \; tag
bind \# set @tag '3' \; tag
bind $ set @tag '4' \; tag
bind % set @tag '5' \; tag
bind ^ set @tag '6' \; tag
bind & set @tag '7' \; tag
bind * set @tag '8' \; tag
bind ( set @tag '9' \; tag
bind ) set @tag '0' \; tag
bind - set @shcmd 'wpctl set-volume %DEFAULT_AUDIO_SINK% 5%-; kill -44 $(pidof dwmblocks)' \; spawn
bind _ set @shcmd 'wpctl set-volume %DEFAULT_AUDIO_SINK% 15%-; kill -44 $(pidof dwmblocks)' \; spawn
bind = set @shcmd 'wpctl set-volume %DEFAULT_AUDIO_SINK% 5%+; kill -44 $(pidof dwmblocks)' \; spawn
bind + set @shcmd 'wpctl set-volume %DEFAULT_AUDIO_SINK% 15%+; kill -44 $(pidof dwmblocks)' \; spawn
bind BSpace set @shcmd 'sysact' \; spawn

bind Tab set @tag '0' \; tag
#bind BTab set @shcmd '' \; spawn
bind q killclient
bind Q set @shcmd 'sysact' \; spawn
bind w set @shcmd '$BROWSER' \; spawn
bind W set @shcmd 'nmtui' \; command
bind e set @shcmd 'neomutt ; pkill -RTMIN+12 dwmblocks; rmdir ~/.abook 2>/dev/null' \; command
bind E set @shcmd 'abook -C ~/.config/abook/abookrc --datafile ~/.config/abook/addressbook' \; command
bind r set @shcmd 'lfub' \; command
bind R set @shcmd 'htop' \; command
bind t setlayout-tile
bind T setlayout-bstack
#bind y setlayout-spiral
#bind Y setlayout-dwindle
bind u setlayout-deck
bind U setlayout-monocle
bind i setlayout-centeredmaster
#bind I setlayout-centeredfloatingmaster
#bind -r o set @shcmd '' \; spawn # increase main panes
#bind -r O set @shcmd '' \; spawn # decrease main panes
bind p set @shcmd 'mpc toggle' \; spawn
bind P set @shcmd 'mpc pause; pauseallmpv' \; spawn
bind \[ set @shcmd 'mpc seek -10' \; spawn
bind \{ set @shcmd 'mpc seek -60' \; spawn
bind \] set @shcmd 'mpc seek +10' \; spawn
bind \} set @shcmd 'mpc seek +60' \; spawn
bind \\ set @op '0' \; focusmon
#bind | set @shcmd '' \; spawn

bind a togglegaps
bind A defaultgaps
#bind s set #shcmd '' \; spawn # toggle sticky pane
#bind S set @shcmd '' \; spawn
bind d set @shcmd 'dmenu_run' \; spawn
bind D set @shcmd 'passmenu' \; command
bind f togglefullscr
bind F zoom
bind g set @op '-' \; shiftview
bind G set @op '-' \; shifttag
bind h set @op '-' \; setmfact
bind H set @op '-' \; stacker
bind j set @op '+' \; focusmon
bind J set @op '+' \; stacker
bind k set @op '-' \; focusmon
bind K set @op '+' \; stacker
bind l set @op '+' \; setmfact
bind \; set @op '+' \; shiftview
bind : set @op '+' \; shifttag
bind \' set @shcmd 'bc -lq' \; togglescratch
bind \" togglegaps
bind Enter set -u @shcmd \; terminal
bind S-Enter set -u @shcmd \; togglescratch

bind z set @op '-' \; incrgaps
#bind Z set @shcmd '' \; spawn
bind x set @op '+' \; incrgaps
#bind X set @shcmd '' \; spawn
bind c set @shcmd 'profanity' \; command
#bind C set @shcmd '' \; spawn
bind v zoom
bind V set @tag '0' \; tag
bind b togglebar
#bind B set @shcmd '' \; spawn
bind n set @shcmd 'nvim -c VimwikiIndex' \; command
bind N set @shcmd 'newsboat ; pkill -RTMIN+6 dwmblocks' \; command
bind m set @shcmd 'ncmpcpp' \; command
bind M set @shcmd 'wpctl set-mute %DEFAULT_AUDIO_SINK% toggle; kill -44 $(pidof dwmblocks)' \; spawn
bind , set @shcmd 'mpc prev' \; spawn
bind < set @shcmd 'mpc seek 0%' \; spawn
bind . set @shcmd 'mpc next' \; spawn
bind > set @shcmd 'mpc repeat' \; spawn
#bind / set @shcmd '' \; spawn
#bind ? set @shcmd '' \; spawn

bind Left set @op '-' \; focusmon
bind S-Left set @op '-' \; shiftview
bind Right set @op '+' \; focusmon
bind S-Right set @op '+' \; shiftview

bind PgUp set @op '-' \; shiftview
bind S-PgUp set @op '-' \; shifttag
bind PgDn set @op '+' \; shiftview
bind S-PgDn set @op '+' \; shifttag
bind Insert set @shcmd 'xdotool type $(grep -v "^#" ~/.local/share/larbs/snippets | dmenu -i -l 50 | cut -d" " -f1)' \; spawn

bind F1 set @shcmd 'groff -mom /usr/local/share/dwm/larbs.mom -Tpdf | zathura -' \; spawn
bind F2 set @shcmd 'tutorialvids' \; spawn
bind F3 set @shcmd 'displayselect' \; spawn
bind F4 set @shcmd 'pulsemixer; kill -44 $(pidof dwmblocks)' \; command
bind F5 source-file ~/.config/tmux/tmux.conf # replaces xrdb
bind F6 set @shcmd 'torwrap' \; spawn
bind F7 set @shcmd 'td-toggle' \; spawn
bind F8 set @shcmd 'mailsync' \; spawn
bind F9 set @shcmd 'mounter' \; spawn
bind F10 set @shcmd 'unmounter' \; spawn
bind F11 set @shcmd 'mpv --untimed --no-cache --no-osc --no-input-default-bindings --profile=low-latency --input-conf=/dev/null --title=webcam $(ls /dev/video[0,2,4,6,8] | tail -n 1)' \; spawn
bind F12 set @shcmd 'remaps' \; spawn
bind Space zoom
bind S-Space togglefloating

#bind Print set @shcmd 'maim pic-full-$(date "+%y%m%d-%H%M-%S").png' \; spawn
#bind S-Print set @shcmd 'maimpick' \; spawn
#bind Print set @shcmd 'dmenurecord' \; spawn
#bind S-Print "dmenurecord"
bind Delete set @shcmd 'dmenurecord' \; spawn
#bind ScrollLock "killall screenkey || screen key &"

# Buttons

set -g mouse on

#bind -n MouseDown1Pane selectp -t = \; send -M
#bind -n MouseDown1Status selectw -t =
#bind -n MouseDown2Pane selectp \; send -M
#bind -n MouseDown3Pane selectp \; send -M
#bind -n MouseDrag1Pane send -M
#bind -n MouseDrag1Border resize-pane -M
#bind -n WheelUpPane send -M
#bind -n WheelUpStatus previous-window
#bind -n WheelDownStatus next-window
#bind -n DoubleClick1Pane selectp
#bind -n TripleClick1Pane selectp
